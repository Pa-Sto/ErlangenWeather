<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Weather Prediction Erlangen</title>
  <!-- Tailwind CSS via CDN for styling -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-900">
  <div class="container mx-auto p-4">
    <h1 class="text-3xl font-bold mb-4">City Weather Predictions</h1>

    <!-- Next Day Forecast Section -->
    <div id="prediction" class="bg-white rounded shadow p-4 mb-4">
    <h2 class="text-2xl font-semibold mb-2">Next Day Forecast</h2>
    <p class="text-sm text-gray-600 mb-2">
      Forecast for <span id="forecast-day" class="font-medium">—</span>
      • Updated <span id="generated-at">—</span>
    </p>
    <p class="mb-2">Window: <strong><span id="window-range">—</span></strong></p>
    <div id="summary-cards" class="grid grid-cols-1 sm:grid-cols-3 gap-3 mb-3">
      <div class="p-3 bg-rose-50 rounded">
        <span class="block text-xs uppercase text-gray-500">Max</span>
        <span id="max-temp" class="text-xl font-semibold">—</span>
        <div id="max-time" class="text-xs text-gray-500">—</div>
      </div>
      <div class="p-3 bg-blue-50 rounded">
        <span class="block text-xs uppercase text-gray-500">Min</span>
        <span id="min-temp" class="text-xl font-semibold">—</span>
        <div id="min-time" class="text-xs text-gray-500">—</div>
      </div>
      <div class="p-3 bg-emerald-50 rounded">
        <span class="block text-xs uppercase text-gray-500">Mean</span>
        <span id="mean-temp" class="text-xl font-semibold">—</span>
      </div>
    </div>
    <p id="pred-loading">Loading hourly forecast…</p>
    <ul id="pred-list" class="list-disc list-inside"></ul>
  </div>

    <!-- Model Details Section -->
    <div id="model-info" class="bg-white rounded shadow p-4 mb-4">
      <h2 class="text-2xl font-semibold mb-2">Model Details</h2>
      <p id="model-loading">Loading...</p>
      <ul id="model-list" class="list-disc list-inside text-sm"></ul>
    </div>

    <!-- Model Accuracy Section -->
    <div id="accuracy" class="bg-white rounded shadow p-4">
      <h2 class="text-2xl font-semibold mb-2">Past Model Accuracy</h2>
      <p id="acc-loading">Loading...</p>
      <ul id="acc-list" class="list-disc list-inside"></ul>
    </div>
  </div>

  <script>
    // Endpoints for static JSON files (GitHub Pages-friendly)
    const POINT_ENDPOINT      = 'prediction_point.json';
    const PREDICTION_ENDPOINT = 'prediction.json';
    const ACCURACY_ENDPOINT   = 'accuracy.json';

    // Helpers
    function fmtLocalTime(ts) {
      const d = new Date(ts);
      return d.toLocaleString(undefined, {
        weekday: 'short', month: 'short', day: 'numeric',
        hour: '2-digit', minute: '2-digit'
      });
    }

    // Fetch and render summary (forecast day + max/min/mean)
    async function fetchSummary() {
      try {
        const res = await fetch(`${POINT_ENDPOINT}?cb=${Date.now()}`);
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const data = await res.json();

        // Day & updated time
        const dayName = data.forecast_day_name || '';
        const dayISO  = data.forecast_day || '';
        document.getElementById('forecast-day').textContent = dayName && dayISO ? `${dayName} (${dayISO})` : (dayISO || '—');
        document.getElementById('generated-at').textContent = data.generated_at ? fmtLocalTime(data.generated_at) : '—';

        // Summary cards
        const maxTemp = (data.max_temp_c != null) ? `${data.max_temp_c.toFixed(1)} °C` : '—';
        const minTemp = (data.min_temp_c != null) ? `${data.min_temp_c.toFixed(1)} °C` : '—';
        const meanTemp = (data.mean_temp_c != null) ? `${data.mean_temp_c.toFixed(1)} °C` : '—';
        document.getElementById('max-temp').textContent = maxTemp;
        document.getElementById('min-temp').textContent = minTemp;
        document.getElementById('mean-temp').textContent = meanTemp;
        document.getElementById('max-time').textContent = data.max_time ? fmtLocalTime(data.max_time) : '—';
        document.getElementById('min-time').textContent = data.min_time ? fmtLocalTime(data.min_time) : '—';
      } catch (err) {
        console.error('Summary error:', err);
      }
    }

    // Fetch and render next-day hourly prediction
    async function fetchPrediction() {
      try {
        const res = await fetch(`${PREDICTION_ENDPOINT}?cb=${Date.now()}`);
        const data = await res.json();
        document.getElementById('pred-loading').style.display = 'none';
        const list = document.getElementById('pred-list');
        list.innerHTML = '';

        // data is an object: { 'YYYY-MM-DDTHH:MM:SS': valueC, ... }
        const entries = Object.entries(data)
          .map(([ts, val]) => ({ ts, val }))
          .sort((a, b) => new Date(a.ts) - new Date(b.ts));

        if (entries.length) {
          const first = new Date(entries[0].ts);
          const last  = new Date(entries[entries.length - 1].ts);
          const fmt = (d) => d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
          document.getElementById('window-range').textContent = `${fmt(first)} → ${fmt(last)}`;
        }

        entries.forEach(({ ts, val }) => {
          const li = document.createElement('li');
          const local = new Date(ts);
          const hh = local.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
          li.textContent = `${hh}: ${Number(val).toFixed(1)} °C`;
          list.appendChild(li);
        });
      } catch (error) {
        document.getElementById('pred-loading').textContent = 'Error loading predictions.';
        console.error(error);
      }
    }

    // Fetch and render past accuracy metrics (show latest 10)
    async function fetchAccuracy() {
      try {
        const res = await fetch(`${ACCURACY_ENDPOINT}?cb=${Date.now()}`);
        const data = await res.json();
        document.getElementById('acc-loading').style.display = 'none';
        const list = document.getElementById('acc-list');
        list.innerHTML = '';
        const items = Array.isArray(data) ? data.slice(-10) : [];
        items.forEach(item => {
          const li = document.createElement('li');
          li.textContent = `${item.date}: MAE = ${Number(item.mae).toFixed(2)} °C, MSE = ${Number(item.mse).toFixed(2)}`;
          list.appendChild(li);
        });
      } catch (error) {
        document.getElementById('acc-loading').textContent = 'Error loading accuracy.';
        console.error(error);
      }
    }

    async function fetchModelInfo() {
      try {
        const res = await fetch('model_info.json?cb=' + Date.now());
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const info = await res.json();
        document.getElementById('model-loading').style.display = 'none';
        const list = document.getElementById('model-list');
        const items = [];
        if (info.training_data) {
          const span = info.training_data.span || [null, null];
          items.push(`Training data: ${span[0] || '—'} → ${span[1] || '—'} (${info.training_data.source || ''})`);
        }
        if (info.input) {
          const feats = Array.isArray(info.input.features) ? info.input.features.length : '—';
          items.push(`Input: ${info.input.window_days}-day window • ${feats} features`);
        }
        if (info.output) items.push(`Output: ${info.output}`);
        if (info.architecture) {
          const a = info.architecture;
          items.push(`Architecture: ${a.type} • d_model=${a.d_model}, layers=${a.layers}, heads=${a.heads}`);
        }
        if (info.location) items.push(`Location: lat ${info.location.lat}, lon ${info.location.lon}`);
        list.innerHTML = items.map(t => `<li>${t}</li>`).join('');
      } catch (e) {
        console.error('Model info error:', e);
        const m = document.getElementById('model-loading');
        if (m) m.textContent = 'No model info available.';
      }
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', () => {
      fetchSummary();
      fetchPrediction();
      fetchAccuracy();
      fetchModelInfo();
    });
  </script>
</body>
</html>